#!/bin/sh
# shellcheck shell=sh

# Reuse backend selected by entrypoint
[ -r /run/xt/backend.env ] && . /run/xt/backend.env

run4() {
    if ! ${IPT} "$@" 2>/dev/null; then
        echo "(IPv4) skipped: $*"
    fi
}

run4_critical() {
    if ! ${IPT} "$@" 2>/dev/null; then
        echo "(IPv4) CRITICAL ERROR: Failed to execute: $* - sleeping infinite"
        sleep infinity
    fi
}

run6() {
    if [ -n "$IP6T" ]; then
        if ! ${IP6T} "$@" 2>/dev/null; then
            echo "(IPv6) skipped: $*"
        fi
    fi
}

run6_critical() {
    if [ -n "$IP6T" ]; then
        if ! ${IP6T} "$@" 2>/dev/null; then
            echo "(IPv6) CRITICAL ERROR: Failed to execute: $*"
        fi
    fi
}

# Check if VPN is connected by checking for tun interface
is_vpn_connected() {
    if ip link show tun0 >/dev/null 2>&1; then
        return 0
    else
        return 1
    fi
}
